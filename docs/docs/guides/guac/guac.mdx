---
title: Send SBOMs to Guac
image: ./overview.png
---

import Image from "@theme/IdealImage";
import CodeBlock from "@theme/CodeBlock";
import ContractYAML from "!!raw-loader!/examples/contracts/sbom/spdx-cyclonedx.yaml";

> Graph for Understanding Artifact Composition ([GUAC](https://github.com/guacsec/guac)) aggregates software security metadata into a high fidelity graph database—normalizing entity identities and mapping standard relationships between them. Querying this graph can drive higher-level organizational outcomes such as audit, policy, risk management, and even developer assistance.

Chainloop users can **automatically send signed [in-toto](https://in-toto.io/) attestations and both [CycloneDX](https://cyclonedx.org/) and [SPDX](https://spdx.dev/) Software Bill Of Materials (SBOMs)**
to a cloud storage bucket. From there, [GUAC can be configured](./#configure-guac) to continuously monitor and inject that data.

<Image img={require("./overview.png")} className="light-mode-only" />
<Image img={require("./overview-dark.png")} className="dark-mode-only" />

## Demo

<iframe
  width="100%"
  height="500"
  src="https://www.youtube-nocookie.com/embed/XEeMeyC9ZJs"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowfullscreen
></iframe>

## Configure Workflow

By default, attestations generated by a [Chainloop Workflow](/getting-started/workflow-definition) will be picked up by this integration.
In addition to that, any material of type `SBOM_CYCLONEDX_JSON` or `SBOM_SPDX_JSON` defined in your workflow [contract](/reference/operator/contract) will be taken as well.

<CodeBlock language="yaml" title="example.yaml">
  {ContractYAML}
</CodeBlock>

So the first step is to make sure you have a workflow that describes and attest Software Bill Of Materials. Learn more on how to set it up [here](/guides/sbom-management/).

Proceed to the next step once you have a workflow.

## Configure Integration

There are two steps involved to enable this integration:

1. Register a Guac integration in your Chainloop account
2. Attach this integration to your workflow

### Registration

Currently, this integration only supports [Google Cloud Storage](https://cloud.google.com/storage) (GCS) as a storage provider, with more to come in the future. If you are interested in a specific provider, please [let us know](https://github.com/chainloop-dev/chainloop/issues/new)

#### Using Google Cloud Storage (GCS)

**Prerequisites**

- A Google Cloud Platform (GCP) account
- A GCP project with a GCS bucket
- A GCP service account with write access to the bucket. See [Creating and managing service accounts](https://cloud.google.com/iam/docs/creating-managing-service-accounts) for more information. 
- Once created, download the service account [JSON credentials file](https://developers.google.com/workspace/guides/create-credentials#create_credentials_for_a_service_account)

To get started, you need to register the integration in your Chainloop organization. To know what parameters are accepted, you can use the `chainloop integration available describe` command.

```bash
$ chainloop integration available describe --name guac                              
┌──────┬─────────┬─────────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────┐
│ ID   │ VERSION │ MATERIAL REQUIREMENT                │ DESCRIPTION                                                                                    │
├──────┼─────────┼─────────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────┤
│ guac │ 1.0     │ SBOM_CYCLONEDX_JSON, SBOM_SPDX_JSON │ Export Attestation and SBOMs metadata to a blob storage backend so guacsec/guac can consume it │
└──────┴─────────┴─────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────┘
┌────────────────────────────────────────────────────────────────────────────┐
│ Registration inputs                                                        │
├─────────────┬────────┬──────────┬──────────────────────────────────────────┤
│ FIELD       │ TYPE   │ REQUIRED │ DESCRIPTION                              │
├─────────────┼────────┼──────────┼──────────────────────────────────────────┤
│ bucket      │ string │ yes      │ Bucket name where to store the artifacts │
│ credentials │ string │ yes      │ Credentials to access the bucket         │
│ provider    │ string │ no       │ Blob storage provider: default gcs       │
└─────────────┴────────┴──────────┴──────────────────────────────────────────┘
```

Only `bucket` and `credentials` are required, let's register our integration by running `chainloop integration registered add guac [opts]`

```sh
$ chainloop integration registered add guac --name [my-registration] --opt bucket=[my-bucket-name] --opt credentials=[credentials-content] --opt provider=gcs

# Example
$ chainloop integration registered add guac --name [my-registration] --opt bucket=test-guac --opt credentials="$(cat ./service-account-devel.json)" --opt provider=gcs

┌──────────────────────────────────────┬──────────────────────────────────────┬─────────────────┬──────────────────────────────────────────┬─────────────────────┐
│ ID                                   │ DESCRIPTION                          │ KIND            │ CONFIG                                   │ CREATED AT          │
├──────────────────────────────────────┼──────────────────────────────────────┼─────────────────┼──────────────────────────────────────────┼─────────────────────┤
│ d4b9cec4-d79c-420f-aa63-cbc1cf9e8bdf │ Send to production GCS               │ guac            │ bucket: guac-prod                        │ 29 Jun 23 14:28 UTC │
│                                      │                                      │                 │ provider: gcs                            │                     │
└──────────────────────────────────────┴──────────────────────────────────────┴─────────────────┴──────────────────────────────────────────┴─────────────────────┘
```

### Attachment

Then, in order to use the integration, you need to attach it to a workflow. That way, its attestation metadata and any associated SBOMs are routed to the configured storage backend. 

To do so, just run the `integration attached add` and provide the IDs of the workflow and integration you just registered.

```sh
$ chainloop integration attached add --workflow $WID --integration $IID

# Example
$ chainloop integration attached add --workflow deadbeef --integration d4b9cec4-d79c-420f-aa63-cbc1cf9e8bdf
Integrations attached to workflows
┌──────────────────────────────────────┬─────────────────┬──────────────────────────────────────────┬─────────────────────┬─────────────────┐
│ ID                                   │ KIND            │ CONFIG                                   │ ATTACHED AT         │ WORKFLOW        │
├──────────────────────────────────────┼─────────────────┼──────────────────────────────────────────┼─────────────────────┼─────────────────┤
│ fa970e9c-3716-4d70-b76c-d6716a5f46b1 │ guac            │ bucket: guac-prod                        │ 29 Jun 23 20:48 UTC │ docs/release    │
│                                      │                 │ provider: gcs                            │                     │                 │
└──────────────────────────────────────┴─────────────────┴──────────────────────────────────────────┴─────────────────────┴─────────────────┘
```

That's all on the Chainloop side. Now all new attestation and SBOM metadata files will get uploaded to your Google Cloud Storage bucket.

## Configure Guac

Next, we need to configure Guac to pick up the files from the bucket and inject them into the graph. Please refer to [guacsec/guac](https://docs.guac.sh) documentation to learn more.

But in a nutshell, you need to:

- [Have a Guac instance up and running](https://docs.guac.sh/setup)
- Ingest the data from the bucket into the graph

:::info
Currently, importing GCS data into Guac requires manually running a `collect` command. The community [is discussing](https://github.com/guacsec/guac/issues/1005) how to run this process periodically and automatically.
:::


```bash
# Build the guacone CLI
git clone https://github.com/guacsec/guac.git
cd guac && make build

# Ingest the data
guacone collect gcs test-guac --gcp-credentials-path service-account-devel.json 
```

That's all, now the data is available in the graph and you can query or visualize it.