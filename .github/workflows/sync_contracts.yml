name: Sync Chainloop Workflow contracts
on:
  push:
    branches: ["main"]
    paths:
      - ".github/workflows/contracts/**"
  schedule:
    - cron: "0 0 * * *" # daily at midnight

# Declare default permissions as read only.
permissions: read-all

jobs:
  chainloop_contract_sync:
    name: "[chainloop] Chainloop Contract Sync"
    runs-on: ubuntu-latest
    env:
      CHAINLOOP_TOKEN: ${{ secrets.CHAINLOOP_TOKEN }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install Chainloop
        run: |
          curl -sfL https://dl.chainloop.dev/cli/install.sh | bash -s -- --ee
      - name: Update contract definitions
        run: |
          for file in .github/workflows/contracts/*.yaml; do
            chainloop wf contract apply -f $file
          done
